package jeecg.kxcomm.service.impl.contactm;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
import jeecg.kxcomm.service.contactm.TbContractServiceI;
import org.jeecgframework.core.common.service.impl.CommonServiceImpl;

import jeecg.kxcomm.entity.contactm.TbContractEntity;
import jeecg.kxcomm.entity.contactm.TbOrderEntity;
@Service("tbContractService")
@Transactional
public class TbContractServiceImpl extends CommonServiceImpl implements TbContractServiceI {

	@Override
	public void addMain(TbContractEntity tbContract,
	        List<TbOrderEntity> tbOrderList){
//			//保存主信息
//			this.save(tbContract);
//		
//			/**保存-销售订单*/
//			for(TbOrderEntity tbOrder:tbOrderList){
//				//外键设置
//				tbOrder.setContractId(tbContract.getId());
//				this.save(tbOrder);
//			}
		//保存主信息
		this.save(tbContract);

		/**保存-销售订单*/
		for(TbOrderEntity tbOrder:tbOrderList){
			
			String hql = "from TbOrderEntity where 1 = 1 AND kxOrderNo = ? ";
			List<TbOrderEntity> t = this.findHql(hql,tbOrder.getKxOrderNo());
			
			//t.get(0).setContractId(tbContract.getId());
			t.get(0).setTbContract(tbContract);
			this.updateEntitie(t.get(0));
		}
	}

	@Override
	public void updateMain(TbContractEntity tbContract,
	        List<TbOrderEntity> tbOrderList) {
		//保存订单主信息
		this.saveOrUpdate(tbContract);
		
		
		//===================================================================================
		//获取参数
		Object id0 = tbContract.getId();
		//===================================================================================
		//删除-销售订单
	    String hql0 = "from TbOrderEntity where 1 = 1 AND tbContract = ? ";
	    List<TbOrderEntity> tbOrderOldList = this.findHql(hql0,tbContract);
	    for(TbOrderEntity tbOrder:tbOrderOldList){
	    	//tbOrder.setContractId(null);
	    	tbOrder.setTbContract(null);
	    }
		//this.deleteAllEntitie(tbOrderOldList);
		//保存-销售订单
		for(TbOrderEntity tbOrder:tbOrderList){
			String hql = "from TbOrderEntity where 1 = 1 AND kxOrderNo = ? ";
			List<TbOrderEntity> t = this.findHql(hql,tbOrder.getKxOrderNo());
		
			//t.get(0).setContractId(tbContract.getId());
			t.get(0).setTbContract(tbContract);
			this.updateEntitie(t.get(0));
		}
		
	}

	@Override
	public void delMain(TbContractEntity tbContract) {
		//===================================================================================
		//获取参数
		Object id0 = tbContract.getId();
		//===================================================================================
		//删除-销售订单
	    String hql0 = "from TbOrderEntity where 1 = 1 AND tbContract = ? ";
	    List<TbOrderEntity> tbOrderOldList = this.findHql(hql0,tbContract);
		//this.deleteAllEntitie(tbOrderOldList);
	    for(TbOrderEntity tbOrder:tbOrderOldList){
	    	tbOrder.setTbContract(null);
	    }
	  //删除主表信息
	  	this.delete(tbContract);
	}
	
}